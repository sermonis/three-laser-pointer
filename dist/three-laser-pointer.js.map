{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap a40929b083402d3da1cc","webpack:///./src/index.js","webpack:///external \"THREE\""],"names":["THREE","Line","maxPoints","color","geometry","BufferGeometry","positions","Float32Array","addAttribute","BufferAttribute","material","LineBasicMaterial","computeBoundingSphere","x0","y0","z0","x1","y1","z1","attrPos","attributes","position","count","array","needsUpdate","setDrawRange","_frustumCullingWorkaround","numPoints","x","y","z","i","push","Math","random","arr","length","console","log","updatePoints","_getPointsRandomWalk","Laser","_src","Vector3","_raycaster","Raycaster","tf","visible","src","camera","clone","applyMatrix4","matrixWorld","target","sub","normalize","d","n","multiplyScalar","dot","meshes","recursive","intersects","intersectObjects","origin","direction","set","_raycast","mx","my","width","height","cam","mouse","Vector2","setFromCamera","pt","updatePointsTwo","setHex","point","getSource","dir","computeDirection","isect","raycast","meshes2","filter","m","object","ref","computeReflection","face","normal","isect2","far","add"],"mappings":"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","file":"three-laser-pointer.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"THREE\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"THREE\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"LaserPointer\"] = factory(require(\"THREE\"));\n\telse\n\t\troot[\"LaserPointer\"] = factory(root[\"THREE\"]);\n})(typeof self !== 'undefined' ? self : this, function(__WEBPACK_EXTERNAL_MODULE_1__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap a40929b083402d3da1cc","// https://threejs.org/docs/#manual/introduction/Import-via-modules\nimport * as THREE from 'three';\n\nclass Line extends THREE.Line {\n    // ref. https://stackoverflow.com/questions/31399856/drawing-a-line-with-three-js-dynamically\n    constructor(maxPoints, color=0xff0000) {\n        let geometry = new THREE.BufferGeometry();\n        let positions = new Float32Array( maxPoints * 3 );\n        geometry.addAttribute('position', new THREE.BufferAttribute(positions, 3));\n        let material = new THREE.LineBasicMaterial({\n            color: color,\n        });\n        super(geometry, material);\n    }\n    _frustumCullingWorkaround() {\n        // https://stackoverflow.com/questions/36497763/three-js-line-disappears-if-one-point-is-outside-of-the-cameras-view\n        this.geometry.computeBoundingSphere();\n        //----\n        // this.frustumCulled = false;\n    }\n    updatePointsTwo(x0, y0, z0, x1, y1, z1) {\n        let attrPos = this.geometry.attributes.position;\n        if (attrPos.count < 2) return;\n        attrPos.array[0] = x0;\n        attrPos.array[1] = y0;\n        attrPos.array[2] = z0;\n        attrPos.array[3] = x1;\n        attrPos.array[4] = y1;\n        attrPos.array[5] = z1;\n        attrPos.needsUpdate = true;\n        this.geometry.setDrawRange(0, 2);\n        this._frustumCullingWorkaround();\n    }\n\n    _getPointsRandomWalk(numPoints) {\n        let positions = [];\n        let x = 0;\n        let y = 0;\n        let z = 0;\n        for (let i = 0; i < numPoints; i++) {\n            positions.push(x);\n            positions.push(y);\n            positions.push(z);\n            x += ( Math.random() - 0.5 ) * 2;\n            y += ( Math.random() - 0.5 ) * 2;\n            z += ( Math.random() - 0.5 ) * 2;\n        }\n        return positions;\n    }\n    updatePoints(arr) {\n        let attrPos = this.geometry.attributes.position;\n        let maxPoints = attrPos.count;\n        let numPoints = arr.length / 3;\n        console.log(`numPoints/maxPoints: ${numPoints}/${maxPoints}`);\n        if (numPoints > maxPoints) {\n            numPoints = maxPoints;\n        }\n        for (let i = 0; i < numPoints; i++) {\n            attrPos.array[3*i] = arr[3*i];\n            attrPos.array[3*i+1] = arr[3*i+1];\n            attrPos.array[3*i+2] = arr[3*i+2];\n        }\n        attrPos.needsUpdate = true;\n        this.geometry.setDrawRange(0, numPoints);\n        this._frustumCullingWorkaround();\n    }\n    updatePointsRandomWalk(numPoints) {\n        this.updatePoints(this._getPointsRandomWalk(numPoints));\n    };\n}\n\nclass Laser extends Line {\n    constructor(color=0xff0000) {\n        super(16, color);\n        this._src = new THREE.Vector3(0, 0, 0);\n        this._raycaster = new THREE.Raycaster();\n    }\n    toggle(tf) {\n        this.visible = tf;\n    }\n    setSource(src, camera=null) {\n        // in case camera is given, treat (x, y, z) as in the camera coords\n        this._src = camera ? src.clone().applyMatrix4(camera.matrixWorld) : src.clone();\n    }\n    getSource() {\n        return this._src.clone();\n    }\n    computeDirection(src, target) {\n        return target.clone().sub(src).normalize();\n    }\n    computeReflection(d, n) {\n        // r = d - 2 * (d.n) n;  https://math.stackexchange.com/questions/13261/how-to-get-a-reflection-vector\n        return d.clone().sub(n.clone().multiplyScalar(2*d.dot(n)));\n    }\n    _raycast(meshes, recursive) {\n        let intersects = this._raycaster.intersectObjects(meshes, recursive);\n        return intersects.length > 0 ? intersects[0] : null;\n    }\n    raycast(origin, direction, meshes) {\n        this._raycaster.set(origin, direction);\n        return this._raycast(meshes, false);\n    }\n    raycastFromCamera(mx, my, width, height, cam, meshes, recursive=false) {\n        let mouse = new THREE.Vector2( // normalized (-1 to +1)\n            (mx / width) * 2 - 1,\n            - (my / height) * 2 + 1);\n        // https://threejs.org/docs/#api/core/Raycaster\n        // update the picking ray with the camera and mouse position\n        this._raycaster.setFromCamera(mouse, cam);\n        return this._raycast(meshes, recursive);\n    }\n    point(pt, color=null) {\n        // console.log(\"point():\", this._src, pt);\n        this.updatePointsTwo(\n            this._src.x, this._src.y, this._src.z, pt.x, pt.y, pt.z);\n        if (color) {\n            this.material.color.setHex(color);\n        }\n    }\n    pointWithRaytrace(pt, meshes=[], color=null) { // TODO trace level\n        this.point(pt, color);\n        let src = this.getSource();\n        let dir = this.computeDirection(src, pt);\n        let isect = this.raycast(src, dir, meshes);\n        if (isect !== null) {\n            let meshes2 = [...meshes].filter((m) => {\n                return m !== isect.object;\n            });\n            let ref = this.computeReflection(dir, isect.face.normal);\n            let isect2 = this.raycast(pt, ref, meshes2);\n            console.log('isect2:', isect2);\n            if (isect2 !== null) {\n                this.updatePoints([\n                    src.x, src.y, src.z,\n                    pt.x, pt.y, pt.z,\n                    isect2.point.x, isect2.point.y, isect2.point.z,\n                ]);\n            } else {\n                let far = pt.clone().add(ref.multiplyScalar(9999.0));\n                this.updatePoints([\n                    src.x, src.y, src.z,\n                    pt.x, pt.y, pt.z,\n                    far.x, far.y, far.z,\n                ]);\n            }\n        }\n    }\n}\n\nexport default { Line, Laser };\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"THREE\"\n// module id = 1\n// module chunks = 0"],"sourceRoot":""}