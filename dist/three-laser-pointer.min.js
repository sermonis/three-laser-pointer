!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("THREE")):"function"==typeof define&&define.amd?define(["THREE"],e):"object"==typeof exports?exports.LaserPointer=e(require("THREE")):t.LaserPointer=e(t.THREE)}("undefined"!=typeof self?self:this,function(t){return function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var r={};return e.m=t,e.c=r,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,r){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),s=r(1),c=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(s),l=function(t){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16711680;o(this,e);var n=new c.BufferGeometry,a=new Float32Array(3*t);n.addAttribute("position",new c.BufferAttribute(a,3));var u=new c.LineBasicMaterial({color:r}),s=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,u));return s._maxPoints=t,s._numPoints=0,s}return a(e,t),u(e,[{key:"_frustumCullingWorkaround",value:function(){this.geometry.computeBoundingSphere()}},{key:"_getPointsRandomWalk",value:function(t){for(var e=[],r=0,n=0,o=0,i=0;i<t;i++)e.push(r),e.push(n),e.push(o),r+=2*(Math.random()-.5),n+=2*(Math.random()-.5),o+=2*(Math.random()-.5);return e}},{key:"getPoints",value:function(){var t=[].concat(n(this.geometry.attributes.position.array));return t.length=3*this._numPoints,t}},{key:"updatePoints",value:function(t){var e=this.geometry.attributes.position,r=e.count,n=t.length/3;console.log("numPoints/maxPoints: "+n+"/"+r),n>r&&(n=r);for(var o=0;o<n;o++)e.array[3*o]=t[3*o],e.array[3*o+1]=t[3*o+1],e.array[3*o+2]=t[3*o+2];e.needsUpdate=!0,this.geometry.setDrawRange(0,n),this._frustumCullingWorkaround(),this._numPoints=n}},{key:"clearPoints",value:function(){this.updatePoints([])}},{key:"updatePointsRandomWalk",value:function(t){this.updatePoints(this._getPointsRandomWalk(t))}}]),e}(c.Line),f=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,e);var r={color:16711680,maxPoints:256,infLength:9999},n=Object.assign({},r,t),a=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n.maxPoints,n.color));return a._src=new c.Vector3(0,0,0),a._raycaster=new c.Raycaster,a._infLen=n.infLength,a}return a(e,t),u(e,[{key:"setSource",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._src=e?t.clone().applyMatrix4(e.matrixWorld):t.clone()}},{key:"getSource",value:function(){return this._src.clone()}},{key:"direct",value:function(t,e){return e.clone().sub(t).normalize()}},{key:"reflect",value:function(t,e){return t.clone().sub(e.clone().multiplyScalar(2*t.dot(e)))}},{key:"_raycast",value:function(t,e,r){var n=this._raycaster.intersectObjects(t,e);if(r){for(var o=0;o<n.length;o++)if(n[o].face!=r)return n[o];return null}return n.length>0?n[0]:null}},{key:"raycast",value:function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return this._raycaster.set(t,e),this._raycast(r,!1,n)}},{key:"raycastFromCamera",value:function(t,e,r,n,o,i){var a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=new c.Vector2(t/r*2-1,-e/n*2+1);return this._raycaster.setFromCamera(u,o),this._raycast(i,a,null)}},{key:"point",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.updatePoints([this._src.x,this._src.y,this._src.z,t.x,t.y,t.z]),e&&this.material.color.setHex(e)}},{key:"pointWithRaytrace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16;this.point(t,r);var i=this.getSource(),a=this.direct(i,t),u=this.raycast(i,a,e);if(u){var s=this.computeReflections(t,a,u,e,o);this.updatePoints([i.x,i.y,i.z,t.x,t.y,t.z].concat(n(s)))}}},{key:"computeReflections",value:function(t,e,r,n,o){var i=this,a=[];return function t(e,r,u){var s=(new c.Matrix3).getNormalMatrix(u.object.matrixWorld),l=u.face.normal.clone().applyMatrix3(s).normalize(),f=i.reflect(r,l),p=i.raycast(e,f,n,u.face);if(p){var y=p.point;a.push(y.x),a.push(y.y),a.push(y.z),a.length/3<o&&t(y,f,p)}else{var h=e.clone().add(f.multiplyScalar(i._infLen));a.push(h.x),a.push(h.y),a.push(h.z)}}(t,e,r),a}}]),e}(l);e.default={Line:l,Laser:f},t.exports=e.default},function(e,r){e.exports=t}])});