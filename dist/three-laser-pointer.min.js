!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("THREE")):"function"==typeof define&&define.amd?define(["THREE"],e):"object"==typeof exports?exports.LaserPointer=e(require("THREE")):t.LaserPointer=e(t.THREE)}("undefined"!=typeof self?self:this,function(t){return function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var r={};return e.m=t,e.c=r,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,r){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),s=r(1),c=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(s),l=function(t){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16711680;o(this,e);var n=new c.BufferGeometry,i=new Float32Array(3*t);n.addAttribute("position",new c.BufferAttribute(i,3));var u=new c.LineBasicMaterial({color:r});return a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,u))}return i(e,t),u(e,[{key:"_frustumCullingWorkaround",value:function(){this.geometry.computeBoundingSphere()}},{key:"updatePointsTwo",value:function(t,e,r,n,o,a){var i=this.geometry.attributes.position;i.count<2||(i.array[0]=t,i.array[1]=e,i.array[2]=r,i.array[3]=n,i.array[4]=o,i.array[5]=a,i.needsUpdate=!0,this.geometry.setDrawRange(0,2),this._frustumCullingWorkaround())}},{key:"_getPointsRandomWalk",value:function(t){for(var e=[],r=0,n=0,o=0,a=0;a<t;a++)e.push(r),e.push(n),e.push(o),r+=2*(Math.random()-.5),n+=2*(Math.random()-.5),o+=2*(Math.random()-.5);return e}},{key:"updatePoints",value:function(t){var e=this.geometry.attributes.position,r=e.count,n=t.length/3;console.log("numPoints/maxPoints: "+n+"/"+r),n>r&&(n=r);for(var o=0;o<n;o++)e.array[3*o]=t[3*o],e.array[3*o+1]=t[3*o+1],e.array[3*o+2]=t[3*o+2];e.needsUpdate=!0,this.geometry.setDrawRange(0,n),this._frustumCullingWorkaround()}},{key:"updatePointsRandomWalk",value:function(t){this.updatePoints(this._getPointsRandomWalk(t))}}]),e}(c.Line),f=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16711680;o(this,e);var r=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,16,t));return r._src=new c.Vector3(0,0,0),r._raycaster=new c.Raycaster,r}return i(e,t),u(e,[{key:"toggle",value:function(t){this.visible=t}},{key:"setSource",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._src=e?t.clone().applyMatrix4(e.matrixWorld):t.clone()}},{key:"getSource",value:function(){return this._src.clone()}},{key:"computeDirection",value:function(t,e){return e.clone().sub(t).normalize()}},{key:"computeReflection",value:function(t,e){return t.clone().sub(e.clone().multiplyScalar(2*t.dot(e)))}},{key:"_raycast",value:function(t,e){var r=this._raycaster.intersectObjects(t,e);return r.length>0?r[0]:null}},{key:"raycast",value:function(t,e,r){return this._raycaster.set(t,e),this._raycast(r,!1)}},{key:"raycastFromCamera",value:function(t,e,r,n,o,a){var i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=new c.Vector2(t/r*2-1,-e/n*2+1);return this._raycaster.setFromCamera(u,o),this._raycast(a,i)}},{key:"point",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.updatePointsTwo(this._src.x,this._src.y,this._src.z,t.x,t.y,t.z),e&&this.material.color.setHex(e)}},{key:"pointWithRaytrace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.point(t,r);var o=this.getSource(),a=this.computeDirection(o,t),i=this.raycast(o,a,e);if(null!==i){var u=[].concat(n(e)).filter(function(t){return t!==i.object}),s=this.computeReflection(a,i.face.normal),c=this.raycast(t,s,u);if(console.log("isect2:",c),null!==c)this.updatePoints([o.x,o.y,o.z,t.x,t.y,t.z,c.point.x,c.point.y,c.point.z]);else{var l=t.clone().add(s.multiplyScalar(9999));this.updatePoints([o.x,o.y,o.z,t.x,t.y,t.z,l.x,l.y,l.z])}}}}]),e}(l);e.default={Line:l,Laser:f},t.exports=e.default},function(e,r){e.exports=t}])});